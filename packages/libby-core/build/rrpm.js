!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@babel/runtime/regenerator"),require("@babel/runtime/helpers/asyncToGenerator"),require("@babel/runtime/helpers/classCallCheck"),require("@babel/runtime/helpers/createClass"),require("lodash"),require("@babel/runtime/helpers/extends"),require("@babel/runtime/helpers/toConsumableArray"),require("@babel/runtime/helpers/possibleConstructorReturn"),require("@babel/runtime/helpers/getPrototypeOf"),require("@babel/runtime/helpers/assertThisInitialized"),require("@babel/runtime/helpers/inherits"),require("react"),require("@babel/runtime/helpers/get")):"function"==typeof define&&define.amd?define(["exports","@babel/runtime/regenerator","@babel/runtime/helpers/asyncToGenerator","@babel/runtime/helpers/classCallCheck","@babel/runtime/helpers/createClass","lodash","@babel/runtime/helpers/extends","@babel/runtime/helpers/toConsumableArray","@babel/runtime/helpers/possibleConstructorReturn","@babel/runtime/helpers/getPrototypeOf","@babel/runtime/helpers/assertThisInitialized","@babel/runtime/helpers/inherits","react","@babel/runtime/helpers/get"],t):t((e=e||self).Libby={},e._regeneratorRuntime,e._asyncToGenerator,e._classCallCheck,e._createClass,e._,e._extends,e._toConsumableArray,e._possibleConstructorReturn,e._getPrototypeOf,e._assertThisInitialized,e._inherits,e.React,e._get)}(this,(function(e,t,n,r,i,s,a,u,o,c,l,h,f,p){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n,r=r&&r.hasOwnProperty("default")?r.default:r,i=i&&i.hasOwnProperty("default")?i.default:i,s=s&&s.hasOwnProperty("default")?s.default:s,a=a&&a.hasOwnProperty("default")?a.default:a,u=u&&u.hasOwnProperty("default")?u.default:u,o=o&&o.hasOwnProperty("default")?o.default:o,c=c&&c.hasOwnProperty("default")?c.default:c,l=l&&l.hasOwnProperty("default")?l.default:l,h=h&&h.hasOwnProperty("default")?h.default:h,f=f&&f.hasOwnProperty("default")?f.default:f,p=p&&p.hasOwnProperty("default")?p.default:p;var v=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{save:!1,remove:!1},i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;r(this,e),this.parameter=t,this.operation=n,this.target=i,this.name=s,this.error=null,this.data=[]}return i(e,[{key:"done",value:function(e){this.isResultset()?(this.data=e,this.target.propagateDAO(this.name,e)):this.target.forceUpdate()}},{key:"failed",value:function(e){this.error=e,this.target.forceUpdate()}},{key:"commandHasStarted",value:function(){this.target.stateHasChanged()}},{key:"isResultset",value:function(){return!this.operation.save&&!this.operation.remove}},{key:"isSave",value:function(){return this.operation.save}},{key:"isRemove",value:function(){return this.operation.remove}}]),e}(),g=function(){function e(t,n){r(this,e),this.name=t,this.pk=n,this.listeners=[]}return i(e,[{key:"addStoreListener",value:function(e){this.listeners.push(e)}},{key:"removeStoreListener",value:function(e){s.pull(this.listeners,e)}},{key:"notify",value:function(){var e=this;this.listeners.forEach((function(t){t.storeHasChanged(e.name)}))}}]),e}(),y=function(){function e(t){r(this,e),this.selected=!1;this.getQuery=t,this.config={fields:{},aggregations:[],groups:{}}}var s;return i(e,[{key:"toURL",value:function(){var e=this.config.fields,t=this.config.aggregations,n=this.config.groups,r=[];return isArray(e)&&e.forEach((function(e){r.push("aggregate.field[".concat(e,"]=").concat(e))})),t.forEach((function(e){r.push("aggregate.function[".concat(e.field,"]=").concat(e.operator))})),isArray(n)&&n.forEach((function(e){r.push("aggregate.group[".concat(e,"]=").concat(e))})),r.push("aggregated=true"),r}},{key:"count",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"countof".concat(t),r=e.Operator.COUNT;return this.config.aggregations.push({operator:r,field:t,as:n}),this}},{key:"sum",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sumof".concat(t),r=e.Operator.SUM;return this.config.aggregations.push({operator:r,field:t,as:n}),this}},{key:"avg",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"avgof".concat(t),r=e.Operator.AVG;return this.config.aggregations.push({operator:r,field:t,as:n}),this}},{key:"min",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mninof".concat(t),r=e.Operator.MIN;return this.config.aggregations.push({operator:r,field:t,as:n}),this}},{key:"max",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"maxof".concat(t),r=e.Operator.MAX;return this.config.aggregations.push({operator:r,field:t,as:n}),this}},{key:"groupBy",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.config.groups=t,this.config.fields=t,this}},{key:"run",value:(s=n(t.mark((function e(){var n;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getQuery(),e.abrupt("return",n.run.bind(n)());case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})}]),e}();y.Operator={SUM:"sum",AVG:"avg",MAX:"max",MIN:"min",COUNT:"count"};var d=function(){function e(t){var n=this;r(this,e),this.dao=t,this.aggregated=!1,this._aggregate=new y((function(){return n}));this._config={filter:{},order:[],limit:{from:0,to:0}},this.groupActive=0,this.group=0}var s;return i(e,[{key:"aggregate",value:function(){if(this._aggregated)throw new Error("You can't aggregate multiple times");return this._aggregated=!0,this._config.aggregate=this._aggregate,this._aggregate}},{key:"between",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,s=e.RANGE;return this._config.filter[Symbol(i)]={field:t,value:n,to:r,type:s},this}},{key:"equals",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=e.EQUALS;return this._config.filter[Symbol(r)]={field:t,value:n,type:i},this}},{key:"notEquals",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=e.NOT_EQUALS;return this._config.filter[Symbol(r)]={field:t,value:n,type:i},this}},{key:"higher",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=e.HIGHER;return this._config.filter[Symbol(r)]={field:t,value:n,type:i},this}},{key:"higherOrEquals",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=e.HIGHEROREQUALS;return this._config.filter[Symbol(r)]={field:t,value:n,type:i},this}},{key:"lower",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=e.LOWER;return this._config.filter[Symbol(r)]={field:t,value:n,type:i},this}},{key:"lowerOrEquals",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=e.LOWEROREQUALS;return this._config.filter[Symbol(r)]={field:t,value:n,type:i},this}},{key:"orderBy",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return this._config.order.push({alias:n,field:e,direction:t}),this}},{key:"includes",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=e.INCLUDES;return this._config.filter[Symbol(r)]={field:t,value:n,type:i},this}},{key:"starts",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=e.STARTS;return this._config.filter[Symbol(r)]={field:t,value:n,type:i},this}},{key:"ends",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=e.ENDS;return this._config.filter[Symbol(r)]={field:t,value:n,type:i},this}},{key:"limit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return this._config.limit={from:e,to:t},this}},{key:"groupStart",value:function(){this.group++,this.groupActive++;var t=e.GROUP_START;return this._config.filter[Symbol("group_start")]={field:"group_start",value:"group_start",type:t},this}},{key:"groupEnd",value:function(){this.group--,this.groupActive--;var t=e.GROUP_END;return this._config.filter[Symbol("group_end")]={field:"group_end",value:"group_end",type:t},this}},{key:"and",value:function(){var t=e.AND;return this._config.filter[Symbol("and")]={field:"and",value:"and",type:t},this}},{key:"or",value:function(){var t=e.OR;return this._config.filter[Symbol("or")]={field:"or",value:"or",type:t},this}},{key:"run",value:(s=n(t.mark((function e(n){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.group){e.next=2;break}throw Error("Unbalanced selections");case 2:return e.abrupt("return",this.dao.find(this.config,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"config",get:function(){return this._config}}]),e}();d.OR=Symbol("or"),d.AND=Symbol("and"),d.GROUP_START=Symbol("group_start"),d.GROUP_END=Symbol("group_end"),d.NOT_EQUALS=Symbol("not_equals"),d.RANGE=Symbol("range"),d.EQUALS=Symbol("equals"),d.LOWER=Symbol("lower"),d.LOWEROREQUALS=Symbol("lowerorequals"),d.HIGHER=Symbol("higher"),d.HIGHEROREQUALS=Symbol("higherorequals"),d.INCLUDES=Symbol("includes"),d.STARTS=Symbol("starts"),d.ENDS=Symbol("ends");var m=function(){function e(t,n){r(this,e),this.name=t,this.pk=n,this.resultsetCommands={},this.workers=0,this.errors={}}var s,a,u,o,c,l;return i(e,[{key:"execute",value:(l=n(t.mark((function e(n){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.workers++,delete this.errors[n.name],n.isResultset()&&(this.resultsetCommands[n.name]=n),n.commandHasStarted();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"query",value:function(){return new d(this)}},{key:"find",value:(c=n(t.mark((function n(r){var i,s,a=this,u=arguments;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=u.length>1&&void 0!==u[1]?u[1]:e.DEFAULT_RESULTSET,s=this.createCommand(r,{save:!1,remove:!1},this,i),t.abrupt("return",this.execute(s).then((function(e){return a.done(s,e),e})).catch((function(e){a.failed(s,e)})));case 3:case"end":return t.stop()}}),n,this)}))),function(e){return c.apply(this,arguments)})},{key:"findAll",value:(o=n(t.mark((function n(){var r,i=arguments;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:e.DEFAULT_RESULTSET,t.abrupt("return",this.find(this.query().config,r));case 3:case"end":return t.stop()}}),n,this)}))),function(){return o.apply(this,arguments)})},{key:"save",value:(u=n(t.mark((function e(n){var r,i=this;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createCommand(n,{save:!0,remove:!1},this),e.abrupt("return",this.execute(r).then((function(e){return i.done(r,e),e})).catch((function(e){throw i.failed(r,e),new Error(e)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"resetErrors",value:function(e){e?delete this.errors[e]:this.errors={}}},{key:"clean",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DEFAULT_RESULTSET;delete this.resultsetCommands[t]}},{key:"remove",value:(a=n(t.mark((function e(n){var r,i=this;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createCommand(n,{save:!1,remove:!0},this),e.abrupt("return",this.execute(r).then((function(e){return i.done(r,e),e})).catch((function(e){throw new Error(e)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"findByPk",value:(s=n(t.mark((function n(r){var i,s,a=arguments;return t.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.length>2&&void 0!==a[2]?a[2]:e.DEFAULT_RESULTSET,(s=new d(this)).equals(this.pk,r),t.abrupt("return",this.find(s.config,i));case 6:case"end":return t.stop()}}),n,this)}))),function(e){return s.apply(this,arguments)})},{key:"createCommand",value:function(e,t,n,r){return new v(e,t,n,r)}},{key:"done",value:function(e,t){this.workers--,e.done(t),(e.isSave()||e.isRemove())&&this.strategy.notify()}},{key:"failed",value:function(e,t){this.workers--,this.errors[e.name]=t,t[e.name]=t,e.failed(t)}},{key:"getResultsets",value:function(){var t=Object.keys(this.resultsetCommands);return 1===t.length?this.resultsetCommands[e.DEFAULT_RESULTSET].data:0===t.length?[]:new Proxy(this.resultsetCommands,{get:function(e,t){return e[t].data}})}},{key:"refresh",value:function(){var e=this;Object.keys(this.resultsetCommands).forEach((function(t){try{var n=e.resultsetCommands[t];e.execute(n).then((function(t){e.done(n,t)})).catch((function(t){e.failed(n,t)}))}catch(e){console.log("FALLLLEEEEEEEEE")}}))}}]),e}();m.DEFAULT_RESULTSET="_default";var k=new(function(){function e(){r(this,e),this.daos={},this._sessions={}}return i(e,[{key:"register",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t||(t=e.createDAO()),this.daos[e.name]={dao:t,strategy:e}}},{key:"get",value:function(e){return this.daos[e]}},{key:"addSessionStrategy",value:function(e){this.sessions[e.name]=e,e.recoverSession()}},{key:"getSessionStrategy",value:function(e){return this.sessions[e]}},{key:"sessions",get:function(){return this._sessions}},{key:"listSessions",get:function(){return s.toArray(this._sessions)}}]),e}());var b=function(e){function s(e,t){var n;return r(this,s),(n=o(this,c(s).call(this,e,t))).strategy=k.get(e).strategy,n}var a,u,l,f;return h(s,e),i(s,[{key:"processResultset",value:(f=n(t.mark((function e(n){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.strategy.find(n.parameter));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"processChange",value:(l=n(t.mark((function e(n){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.strategy.save(n.parameter).then((function(e){return e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"processRemove",value:(u=n(t.mark((function e(n){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.strategy.remove(n.parameter).then((function(e){return e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"execute",value:(a=n(t.mark((function e(n){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p(c(s.prototype),"execute",this).call(this,n),n.isSave()){e.next=7;break}if(!n.isRemove()){e.next=4;break}return e.abrupt("return",this.processRemove(n));case 4:return e.abrupt("return",this.processResultset(n));case 7:return e.abrupt("return",this.processChange(n));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})}]),s}(m),S={};S[d.RANGE]=function(e,t,n){return e>=t&&e<=n},S[d.LOWEROREQUALS]=function(e,t){return e<=t},S[d.LOWER]=function(e,t){return e<t},S[d.EQUALS]=function(e,t){return e===t},S[d.HIGHEROREQUALS]=function(e,t){return e>=t},S[d.HIGHER]=function(e,t){return e>t},S[d.INCLUDES]=function(e,t){return e.includes(t)},S[d.STARTS]=function(e,t){return e.startsWith(t)},S[d.ENDS]=function(e,t){return e.endsWith(t)};var E={asc:function(e){return function(t,n){return t[e]===n[e]?0:t[e]>n[e]?1:-1}},desc:function(e){return function(t,n){return t[e]===n[e]?0:t[e]<n[e]?1:-1}}},w=function(e){function a(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return r(this,a),(n=o(this,c(a).call(this,e,t))).setList(i),n}var u,l,f;return h(a,e),i(a,[{key:"find",value:(f=n(t.mark((function e(n){var r,i,s,a,u,o,c,l;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==Object.keys(n).length){e.next=3;break}return e.abrupt("return",this.list);case 3:for(r=this.list,i=n.order,s=n.limit,a=[],u=0;u<r.length;u++)o=r[u],this.evaluate(o,n)&&a.push(o);for(s.from>0&&a.length>0&&(a=-1===s.to?a.slice(0,Math.min(a.length,s.from)):a.slice(s.from-1,Math.max(a.length,s.to))),c=0;c<i.length;c++)l=i[c],a=a.sort(E[l.direction](l.field));return e.abrupt("return",a);case 12:throw e.prev=12,e.t0=e.catch(0),new Error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e){return f.apply(this,arguments)})},{key:"evaluate",value:function(e,t){for(var n=t.filter,r=Object.keys(n),i=0;i<r.length;i++){var s=n[r[i]],a=e[s.field];if(!S[s.type](a,s.value,s.to))return!1}return!0}},{key:"guid",value:function(){function e(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return e()+e(!0)+e(!0)+e()}},{key:"setList",value:function(e){var t=this;this.map={},this._list=[],e.forEach((function(e){var n=s.cloneDeep(e);t._list.push(e),t.map[n[t.pk]]=n}))}},{key:"remove",value:(l=n(t.mark((function e(n){var r,i=this;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.list,s.remove(r,(function(e){return e[i.pk]===n[i.pk]})),this.setList(r),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"save",value:(u=n(t.mark((function e(n){var r,i=this;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=s.cloneDeep(n))[this.pk]?(this.map[r[this.pk]]=r,s.remove(this._list,(function(e){return e[i.pk]===r[i.pk]})),this._list.push(r)):(r[this.pk]=this.guid(),this.map[r[this.pk]]=r,this._list.push(r)),e.abrupt("return",s.cloneDeep(r));case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return u.apply(this,arguments)})},{key:"createDAO",value:function(){var e=this;return(function(t){function n(){return r(this,n),o(this,c(n).call(this,e.name,e.pk))}return h(n,t),n}(b))}},{key:"list",get:function(){return s.cloneDeep(this._list)}}]),a}(g),_=function(){function e(){r(this,e)}var s,a;return i(e,[{key:"perisist",value:(a=n(t.mark((function e(n){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"clean",value:function(){}},{key:"retrieve",value:(s=n(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})}]),e}(),O=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return null};r(this,e),this.mapper=t,this.fallback=n,this.extramapper=[]}return i(e,[{key:"addAttribute",value:function(e,t,n){return this.extramapper.push({name:e,mapper:t,child:n}),this}},{key:"mapField",value:function(e,t){var n=s.get(this.mapper,t),r=null;return s.isString(n)&&(r=s.get(e,n)),null==r&&(r=this.fallback(t,e)),r}},{key:"map",value:function(e,t,n){var r=this,i={};return n.concat(this.extramapper).forEach((function(e){"string"==typeof e?i[e]=r.mapField(t,e):i[e.name]=e.mapper.map(t[e.child])})),new e(i,t)}}]),e}(),R=function(){function e(t,n){r(this,e),this._nativerole=t,this.nativerole=n}return i(e,[{key:"hasPermissions",value:function(e){return!1}},{key:"id",get:function(){return this._nativerole.id}},{key:"name",get:function(){return this._nativerole.name}},{key:"native",get:function(){return this._nativerole}}]),e}(),A=["id","name"],L=function(e){function t(e,n){return r(this,t),o(this,c(t).call(this,e,n))}return h(t,e),i(t,[{key:"map",value:function(e){return p(c(t.prototype),"map",this).call(this,R,e,A)}}],[{key:"create",value:function(e,n){return new t(e,n)}}]),t}(O),U=function(){function e(t,n){r(this,e),this._nativeuser=t,this.originaluser=n}return i(e,[{key:"isGuest",value:function(){return this._nativeuser.isGuest}},{key:"id",get:function(){return this._nativeuser.id}},{key:"native",get:function(){return this._nativeuser}},{key:"original",get:function(){return this.originaluser}},{key:"friendlyName",get:function(){return"".concat(this.name," ").concat(this.lastname)}},{key:"name",get:function(){return this.native.name}},{key:"lastname",get:function(){return this.native.lastname}},{key:"username",get:function(){return this._nativeuser.username}},{key:"role",get:function(){return new R(this._nativeuser.role)}}]),e}(),x=function(e){function t(){return r(this,t),o(this,c(t).call(this,{isGuest:!0,username:"guest",name:"guest",lastname:"",role:{name:"guest"}}))}return h(t,e),t}(U),T=["isGuest","username","name","lastname","id"],C=function(e){function t(e,n){return r(this,t),o(this,c(t).call(this,e,n))}return h(t,e),i(t,[{key:"map",value:function(e){return p(c(t.prototype),"map",this).call(this,U,e,T)}}],[{key:"create",value:function(e,n,r,i){return new t(e,i).addAttribute("role",n,r)}}]),t}(O),D=function(){function e(t){r(this,e),this.listeners=[],this.working=0,this._tokenmanager=new _,this._user=e.GUEST_USER,this.userMapper=null,this.lastMessage=null}var a,u;return i(e,[{key:"setUserMapper",value:function(t,n){this.userMapper=t,e.GUEST_USER=n}},{key:"acceptSession",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._user;this.startWorking(),this.notify(e.LOGGED,t)}},{key:"recoverSession",value:function(){this.startWorking()}},{key:"getLastMessage",value:function(){return this.lastMessage}},{key:"isLogged",value:function(){return this.state===e.NEW_SESSION&&!1===this.user.isGuest()||this.state===e.LOGGED}},{key:"init",value:function(){this.startWorking()}},{key:"startWorking",value:function(){var t=this;this.working++,this.listeners.forEach((function(n){n.newSessionState(e.WORKING,t.name)}))}},{key:"status",value:function(e){}},{key:"login",value:(u=n(t.mark((function e(n,r){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.startWorking();case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"logout",value:(a=n(t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.startWorking();case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"addSessionListener",value:function(e){this.listeners.push(e)}},{key:"removeSessionListener",value:function(e){s.pull(this.listeners,e)}},{key:"notify",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.GUEST_USER,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";try{t===e.NEW_SESSION&&this.getTokenManager().persist(i),this.lastMessage=s,this.working--,this.state=t,this.user=r,this.listeners.forEach((function(e){e.newSessionState(t,n.name)}))}catch(e){this.working--,console.error(e)}}},{key:"getTokenManager",value:function(){return this._tokenmanager}},{key:"setTokenManager",value:function(e){return this._tokenmanager=e,this}},{key:"sessionHasExpired",value:function(){this.startWorking(),this.notify(e.EXPIRED,this.user)}},{key:"user",set:function(e){try{this.userMapper?this._user=this.userMapper.map(e):this._user=e}catch(e){console.error(e)}},get:function(){return this._user}},{key:"state",get:function(){return this._state||e.NO_SESSION},set:function(e){this._state=e}},{key:"name",get:function(){return"SessionStrategy"}}]),e}();D.LOGGED="LOGGED",D.NEW_SESSION="New session",D.FAILED_TO_LOGIN="Failed to get session",D.LOGOUT_SESSION="Logout session",D.NO_SESSION="No session",D.GUEST_USER=new x,D.WORKING="Working",D.EXPIRED="Expired";var G={Component:function(e){function t(e){return r(this,t),o(this,c(t).call(this,e))}return h(t,e),i(t,[{key:"componentDidUpdate",value:function(e,t,n){}},{key:"componentDidMount",value:function(){this.fetchData(this.libby)}},{key:"fetchData",value:function(e){}},{key:"reload",value:function(){this.fetchData(this.libby)}},{key:"draw",value:function(e){return f.createElement("h1",null,"Implement the method draw(libby) to render the screen")}},{key:"render",value:function(){return this.draw(this.libby)}},{key:"libby",get:function(){return this.props.libby}},{key:"working",get:function(){return this.props.working}}]),t}(f.Component),App:"LibbyApp"};e.DAO=m,e.DAOCommand=v,e.DAOQueryBuilder=d,e.Database=k,e.DatabaseConnector=function(e,t){return function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return(function(t){function s(e){var t;r(this,s),t=o(this,c(s).call(this,e));var i=l(t);return t.state={libby:new Proxy({},{findErrors:function(){var e=[];return Object.keys(i.state.libby).forEach((function(t){var n=i.state.libby[t];n.name&&Object.keys(n.errors).length>0&&e.push.apply(e,u(Object.values(n.errors)))})),e},workingSession:function(){var e=0;return k.listSessions.forEach((function(t){e+=t.working})),e},workingDAO:function(){var e=0;return i.state&&Object.keys(i.state.libby).forEach((function(t){var n=i.state.libby[t];n.name&&(e+=n.workers)})),e},get:function(e,t){switch(t){case"workingDAO":return this.workingDAO()>0;case"workingSession":return this.workingSession()>0;case"working":return this.workingSession()+this.workingDAO()>0;case"hasErrors":return this.findErrors().length>0;case"errors":return this.findErrors();case"session":return new Proxy({},{set:function(e,t,n){var r=Object.keys(k.sessions);if(1===r.length){var i=k.sessions[r[0]];if(Reflect.has(i,t))return Reflect.set(i,t,n)}return Reflect.set(k.sessions,t,n)},get:function(e,t){var n=Object.keys(k.sessions);if(1===n.length){var r=k.sessions[n[0]];if(Reflect.has(r,t))return r[t]}return k.sessions[t]}})}return Reflect.get(e,t)}})},n.forEach((function(e){var n=new(0,k.get(e).dao);n.createCommand=function(e,n,r,i){return new v(e,n,l(t),i)},t.state.libby[e]=new Proxy(n,{get:function(e,t){return"data"===t?e.getResultsets():Reflect.get(e,t)}})})),t}return h(s,t),i(s,[{key:"componentWillMount",value:function(){var e=this;n.forEach((function(t){k.get(t).strategy.addStoreListener(e)})),Object.keys(k.sessions).forEach((function(t){k.sessions[t].addSessionListener(e)}))}},{key:"componentWillUnmount",value:function(){var e=this;n.forEach((function(t){k.get(t).strategy.removeStoreListener(e)})),Object.keys(k.sessions).forEach((function(t){k.sessions[t].removeSessionListener(e)}))}},{key:"newSessionState",value:function(e,t){this.state.libby.sessionChanged=!0,this.setState({libby:this.state.libby})}},{key:"storeHasChanged",value:function(e){this.state.libby[e].refresh()}},{key:"stateHasChanged",value:function(){this.forceUpdate()}},{key:"propagateDAO",value:function(e,t){this.state.libby.sessionChanged=!1,this.setState({libby:this.state.libby})}},{key:"render",value:function(){return f.createElement(e,a({libby:this.state.libby},this.props))}}]),s}(f.Component))}},e.StoreStrategy=g,e.MemoryDAO=b,e.MemoryStoreStrategy=w,e.SessionStore=_,e.RoleMapper=L,e.UserMapper=C,e.SessionStrategy=D,e.Libby=G,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rrpm.js.map
